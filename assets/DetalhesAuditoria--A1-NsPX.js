import{_ as z,f,g as L,h as O,L as T,c as d,a as e,i as x,t as i,j as c,w as u,v as p,F as D,r as I,o as r,n as N,d as J}from"./index-CItD2XWC.js";const R={class:"main-content"},B={class:"d-flex justify-content-between align-items-center mb-4"},j={class:"titulo"},K={key:0,class:"card-detalhes"},$={key:0,class:"mapa-container"},h={key:1,class:"card-detalhes"},F={class:"grid-form"},G={class:"auditores-edicao"},P={class:"tabela-auditores"},Y=["onClick"],q=["value","checked","onChange"],W={key:2,class:"auditores-box"},Z="AIzaSyDYZ11IEa0narWEnimzpK99Giar764y2U4",H={__name:"DetalhesAuditoria",setup(Q){const V=O(),s=f({}),o=f({}),S=f([]),k=f([]),y=f(!1),A=f(null);L(async()=>{const n=localStorage.getItem("auditorias"),a=localStorage.getItem("auditores"),l=n?JSON.parse(n):[],v=a?JSON.parse(a):[],t=l.find(g=>g.id===parseInt(V.params.id));if(!t){alert("Auditoria não encontrada.");return}if(s.value=t,o.value={...t,auditores:[...t.auditores],coordenadas:t.coordenadas||{lat:"",lng:""}},t.coordenadas&&typeof t.coordenadas=="object"){await new T({apiKey:Z,version:"weekly"}).load();const U=new google.maps.Map(A.value,{center:{lat:t.coordenadas.lat,lng:t.coordenadas.lng},zoom:15});new google.maps.Marker({position:{lat:t.coordenadas.lat,lng:t.coordenadas.lng},map:U,title:t.nome})}const m=v.filter(g=>t.auditores.includes(g.id)),b=v.filter(g=>!t.auditores.includes(g.id));S.value=[...m,...b],k.value=m});function w(n){return n?new Date(n).toLocaleString("pt-PT"):"—"}const E=()=>{try{const n=localStorage.getItem("auditorias"),a=n?JSON.parse(n):[],l=a.findIndex(m=>m.id===o.value.id);l!==-1&&(a[l]={...o.value}),localStorage.setItem("auditorias",JSON.stringify(a)),s.value={...o.value},y.value=!1;const v=localStorage.getItem("auditores"),t=v?JSON.parse(v):[];k.value=s.value.auditores.map(m=>t.find(b=>b.id===m)).filter(Boolean),alert("✅ Alterações guardadas com sucesso!")}catch(n){console.error("Erro ao guardar alterações:",n),alert("Não foi possível guardar as alterações.")}},M=()=>{o.value={...s.value,auditores:[...s.value.auditores]},y.value=!1},C=n=>{const a=o.value.auditores.indexOf(n);a===-1?o.value.auditores.push(n):o.value.auditores.splice(a,1)};return(n,a)=>(r(),d("div",R,[e("div",B,[e("h1",j,i(s.value.nome),1),e("button",{onClick:a[0]||(a[0]=l=>y.value=!0),class:"btn-editar"},"✏️ Editar")]),y.value?(r(),d("div",h,[e("div",F,[u(e("input",{"onUpdate:modelValue":a[1]||(a[1]=l=>o.value.nome=l),placeholder:"Nome da Auditoria"},null,512),[[p,o.value.nome]]),u(e("input",{"onUpdate:modelValue":a[2]||(a[2]=l=>o.value.tipo=l),placeholder:"Tipo"},null,512),[[p,o.value.tipo]]),u(e("input",{"onUpdate:modelValue":a[3]||(a[3]=l=>o.value.origem=l),placeholder:"Origem"},null,512),[[p,o.value.origem]]),u(e("input",{"onUpdate:modelValue":a[4]||(a[4]=l=>o.value.local=l),placeholder:"Local"},null,512),[[p,o.value.local]]),u(e("input",{"onUpdate:modelValue":a[5]||(a[5]=l=>o.value.morada=l),placeholder:"Morada"},null,512),[[p,o.value.morada]]),u(e("input",{"onUpdate:modelValue":a[6]||(a[6]=l=>o.value.descricao=l),placeholder:"Descrição"},null,512),[[p,o.value.descricao]]),u(e("input",{"onUpdate:modelValue":a[7]||(a[7]=l=>o.value.materiais=l),placeholder:"Materiais"},null,512),[[p,o.value.materiais]]),u(e("input",{"onUpdate:modelValue":a[8]||(a[8]=l=>o.value.data=l),type:"date"},null,512),[[p,o.value.data]])]),e("div",G,[a[20]||(a[20]=e("h3",null,"Equipa de Auditores",-1)),e("table",P,[a[19]||(a[19]=e("thead",null,[e("tr",null,[e("th",null,"ID"),e("th",null,"Nome"),e("th",null,"Localidade"),e("th",null,"Área"),e("th",null,"Auditorias")])],-1)),e("tbody",null,[(r(!0),d(D,null,I(S.value,l=>(r(),d("tr",{key:l.id,class:N({selecionado:o.value.auditores.includes(l.id)}),onClick:v=>C(l.id),style:{cursor:"pointer"}},[e("td",null,[e("input",{type:"checkbox",value:l.id,checked:o.value.auditores.includes(l.id),onClick:a[9]||(a[9]=J(()=>{},["stop"])),onChange:v=>C(l.id)},null,40,q)]),e("td",null,i(l.nomeCompleto),1),e("td",null,i(l.localidade),1),a[18]||(a[18]=e("td",null,"—",-1)),e("td",null,[e("span",{class:N({badge:!0,verde:l.auditoriasRealizadas>0,vermelho:l.auditoriasRealizadas===0})},i(l.auditoriasRealizadas),3)])],10,Y))),128))])])]),e("div",{class:"botoes-edicao"},[e("button",{class:"btn-guardar",onClick:E},"💾 Guardar"),e("button",{class:"btn-cancelar",onClick:M},"✖ Cancelar")])])):(r(),d("div",K,[e("p",null,[a[10]||(a[10]=e("strong",null,"Descrição:",-1)),c(" "+i(s.value.descricao),1)]),e("p",null,[a[11]||(a[11]=e("strong",null,"Tipo:",-1)),c(" "+i(s.value.tipo),1)]),e("p",null,[a[12]||(a[12]=e("strong",null,"Origem:",-1)),c(" "+i(s.value.origem),1)]),e("p",null,[a[13]||(a[13]=e("strong",null,"Local:",-1)),c(" "+i(s.value.local),1)]),e("p",null,[a[14]||(a[14]=e("strong",null,"Morada:",-1)),c(" "+i(s.value.morada),1)]),e("p",null,[a[15]||(a[15]=e("strong",null,"Data:",-1)),c(" "+i(w(s.value.data)),1)]),e("p",null,[a[16]||(a[16]=e("strong",null,"Materiais:",-1)),c(" "+i(s.value.materiais||"—"),1)]),s.value.coordenadas?(r(),d("div",$,[a[17]||(a[17]=e("div",{class:"mapa-header"},[e("i",{class:"bi bi-geo-alt-fill"}),e("span",null,"Localização da Auditoria")],-1)),e("div",{ref_key:"mapContainer",ref:A,class:"mapa-visual"},null,512)])):x("",!0)])),y.value?x("",!0):(r(),d("div",W,[a[21]||(a[21]=e("h3",null,"Auditores Responsáveis",-1)),e("ul",null,[(r(!0),d(D,null,I(k.value,l=>(r(),d("li",{key:l.id},i(l.id)+" - "+i(l.nomeCompleto),1))),128))])]))]))}},_=z(H,[["__scopeId","data-v-8db561d3"]]);export{_ as default};

import{_ as x,c as S,a as i,w as e,v as s,b as I,F as y,r as N,d as g,o as c,n as A,e as O,t as m}from"./index-CItD2XWC.js";const C={name:"CriarAuditoria",data(){return{novaAuditoria:{nome:"",origem:"Interna",descricao:"",tipo:"",local:"",morada:"",materiais:"",data:"",estado:"Nova",coordenadas:{lat:"",lng:""},auditores:[]},auditores:[],auditoresSelecionados:[]}},mounted(){const l=localStorage.getItem("auditores");this.auditores=l?JSON.parse(l):[];const o=localStorage.getItem("ocorrenciaSelecionada");if(o){const u=JSON.parse(o);if(u.coordenadas){const[d,a]=u.coordenadas.split(",").map(r=>r.trim());this.novaAuditoria.coordenadas={lat:parseFloat(d),lng:parseFloat(a)}}localStorage.removeItem("ocorrenciaSelecionada")}},methods:{alternarSelecao(l){const o=this.auditoresSelecionados.indexOf(l);o!==-1?this.auditoresSelecionados.splice(o,1):this.auditoresSelecionados.push(l)},criarAuditoria(){const l=localStorage.getItem("auditorias"),o=l?JSON.parse(l):[],u=o.length>0?Math.max(...o.map(t=>t.id))+1:1;this.novaAuditoria.id=u,this.novaAuditoria.auditores=this.auditoresSelecionados;const d=this.$route.params.idOcorrencia;let a=null;if(d){const t=localStorage.getItem("ocorrencias"),n=t?JSON.parse(t):[];if(a=n.find(p=>p.id===parseInt(d)),a&&a.coordenadas){const[p,b]=a.coordenadas.split(",").map(f=>f.trim());this.novaAuditoria.coordenadas={lat:parseFloat(p),lng:parseFloat(b)}}const v=n.filter(p=>p.id!==parseInt(d));localStorage.setItem("ocorrencias",JSON.stringify(v))}o.push({...this.novaAuditoria});const r=[...this.auditores];this.auditoresSelecionados.forEach(t=>{const n=r.find(v=>v.id===t);n&&n.auditoriasRealizadas++}),localStorage.setItem("auditorias",JSON.stringify(o)),localStorage.setItem("auditores",JSON.stringify(r)),alert("✅ Auditoria criada com sucesso!"),this.$router.push("/auditorias")}}},V={class:"criar-auditoria"},U={class:"mt-5"},k={class:"tabela-scroll"},J={class:"custom-table w-100"},M=["onClick"],F=["value"];function z(l,o,u,d,a,r){return c(),S("div",V,[o[23]||(o[23]=i("h1",null,"Criar Nova Auditoria",-1)),i("form",{onSubmit:o[10]||(o[10]=g((...t)=>r.criarAuditoria&&r.criarAuditoria(...t),["prevent"]))},[i("div",null,[o[11]||(o[11]=i("label",null,"Nome:",-1)),e(i("input",{"onUpdate:modelValue":o[0]||(o[0]=t=>a.novaAuditoria.nome=t),type:"text",required:""},null,512),[[s,a.novaAuditoria.nome]])]),i("div",null,[o[13]||(o[13]=i("label",null,"Auditoria:",-1)),e(i("select",{"onUpdate:modelValue":o[1]||(o[1]=t=>a.novaAuditoria.origem=t)},o[12]||(o[12]=[i("option",null,"Interna",-1),i("option",null,"Externa",-1)]),512),[[I,a.novaAuditoria.origem]])]),i("div",null,[o[14]||(o[14]=i("label",null,"Descrição:",-1)),e(i("textarea",{"onUpdate:modelValue":o[2]||(o[2]=t=>a.novaAuditoria.descricao=t)},null,512),[[s,a.novaAuditoria.descricao]])]),i("div",null,[o[15]||(o[15]=i("label",null,"Tipo:",-1)),e(i("input",{"onUpdate:modelValue":o[3]||(o[3]=t=>a.novaAuditoria.tipo=t),type:"text"},null,512),[[s,a.novaAuditoria.tipo]])]),i("div",null,[o[16]||(o[16]=i("label",null,"Local:",-1)),e(i("input",{"onUpdate:modelValue":o[4]||(o[4]=t=>a.novaAuditoria.local=t),type:"text"},null,512),[[s,a.novaAuditoria.local]])]),i("div",null,[o[17]||(o[17]=i("label",null,"Morada:",-1)),e(i("input",{"onUpdate:modelValue":o[5]||(o[5]=t=>a.novaAuditoria.morada=t),type:"text"},null,512),[[s,a.novaAuditoria.morada]])]),i("div",null,[o[18]||(o[18]=i("label",null,"Materiais Necessários:",-1)),e(i("textarea",{"onUpdate:modelValue":o[6]||(o[6]=t=>a.novaAuditoria.materiais=t)},null,512),[[s,a.novaAuditoria.materiais]])]),i("div",null,[o[19]||(o[19]=i("label",null,"Data:",-1)),e(i("input",{"onUpdate:modelValue":o[7]||(o[7]=t=>a.novaAuditoria.data=t),type:"datetime-local"},null,512),[[s,a.novaAuditoria.data]])]),i("div",U,[o[21]||(o[21]=i("h5",{class:"mb-3"},"Equipa de Auditores",-1)),i("div",k,[i("table",J,[o[20]||(o[20]=i("thead",null,[i("tr",null,[i("th",null,"ID"),i("th",null,"Nome"),i("th",null,"Localidade"),i("th",null,"Área"),i("th",null,"Auditorias")])],-1)),i("tbody",null,[(c(!0),S(y,null,N(a.auditores,t=>(c(),S("tr",{key:t.id,onClick:n=>r.alternarSelecao(t.id),class:A({"linha-selecionada":a.auditoresSelecionados.includes(t.id)})},[i("td",null,[e(i("input",{type:"checkbox",value:t.id,"onUpdate:modelValue":o[8]||(o[8]=n=>a.auditoresSelecionados=n),onClick:o[9]||(o[9]=g(()=>{},["stop"]))},null,8,F),[[O,a.auditoresSelecionados]])]),i("td",null,m(t.nomeCompleto),1),i("td",null,m(t.localidade),1),i("td",null,m(t.area||"—"),1),i("td",null,[i("span",{class:A(["badge",t.auditoriasRealizadas>0?"bg-success":"bg-danger"])},m(t.auditoriasRealizadas),3)])],10,M))),128))])])])]),o[22]||(o[22]=i("div",{class:"mt-4 text-end"},[i("button",{type:"submit"},"Criar")],-1))],32)])}const w=x(C,[["render",z],["__scopeId","data-v-442a47be"]]);export{w as default};

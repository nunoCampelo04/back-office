import{_ as b,c,a as i,w as e,v as s,b as I,F as O,r as N,d as x,o as S,n as g,t as p}from"./index-BWgw7rp-.js";const V={name:"CriarAuditoria",data(){return{novaAuditoria:{nome:"",origem:"Interna",descricao:"",tipo:"",local:"",morada:"",materiais:"",data:"",estado:"Nova",coordenadas:{lat:"",lng:""},auditores:[]},auditores:[],auditoresSelecionados:[]}},mounted(){const l=localStorage.getItem("auditores");this.auditores=l?JSON.parse(l):[];const o=localStorage.getItem("ocorrenciaSelecionada");if(o){const u=JSON.parse(o);if(u.coordenadas){const[n,t]=u.coordenadas.split(",").map(r=>r.trim());this.novaAuditoria.coordenadas={lat:parseFloat(n),lng:parseFloat(t)}}localStorage.removeItem("ocorrenciaSelecionada")}},methods:{alternarSelecao(l){const o=this.auditoresSelecionados.indexOf(l);o!==-1?this.auditoresSelecionados.splice(o,1):this.auditoresSelecionados.push(l)},criarAuditoria(){const l=localStorage.getItem("auditorias"),o=l?JSON.parse(l):[],u=o.length>0?Math.max(...o.map(a=>a.id))+1:1;this.novaAuditoria.id=u,this.novaAuditoria.auditores=this.auditoresSelecionados;const n=this.$route.params.idOcorrencia;let t=null;if(n){const a=localStorage.getItem("ocorrencias"),d=a?JSON.parse(a):[];if(t=d.find(m=>m.id===parseInt(n)),t&&t.coordenadas){const[m,A]=t.coordenadas.split(",").map(f=>f.trim());this.novaAuditoria.coordenadas={lat:parseFloat(m),lng:parseFloat(A)}}const v=d.filter(m=>m.id!==parseInt(n));localStorage.setItem("ocorrencias",JSON.stringify(v))}o.push({...this.novaAuditoria});const r=[...this.auditores];this.auditoresSelecionados.forEach(a=>{const d=r.find(v=>v.id===a);d&&d.auditoriasRealizadas++}),localStorage.setItem("auditorias",JSON.stringify(o)),localStorage.setItem("auditores",JSON.stringify(r)),alert("✅ Auditoria criada com sucesso!"),this.$router.push("/auditorias")}}},y={class:"criar-auditoria"},U={class:"form-grid"},C={class:"full-width"},J={class:"full-width"},F={class:"tabela-scroll"},M={class:"custom-table"},k=["onClick"];function w(l,o,u,n,t,r){return S(),c("div",y,[o[21]||(o[21]=i("h1",null,[i("strong",null,"Nova Auditoria")],-1)),i("form",{onSubmit:o[8]||(o[8]=x((...a)=>r.criarAuditoria&&r.criarAuditoria(...a),["prevent"]))},[i("div",U,[i("div",null,[o[9]||(o[9]=i("label",null,"Nome:",-1)),e(i("input",{"onUpdate:modelValue":o[0]||(o[0]=a=>t.novaAuditoria.nome=a),required:""},null,512),[[s,t.novaAuditoria.nome]])]),i("div",null,[o[11]||(o[11]=i("label",null,"Origem:",-1)),e(i("select",{"onUpdate:modelValue":o[1]||(o[1]=a=>t.novaAuditoria.origem=a)},o[10]||(o[10]=[i("option",null,"Interna",-1),i("option",null,"Externa",-1)]),512),[[I,t.novaAuditoria.origem]])]),i("div",C,[o[12]||(o[12]=i("label",null,"Descrição:",-1)),e(i("textarea",{"onUpdate:modelValue":o[2]||(o[2]=a=>t.novaAuditoria.descricao=a)},null,512),[[s,t.novaAuditoria.descricao]])]),i("div",null,[o[13]||(o[13]=i("label",null,"Tipo:",-1)),e(i("input",{"onUpdate:modelValue":o[3]||(o[3]=a=>t.novaAuditoria.tipo=a)},null,512),[[s,t.novaAuditoria.tipo]])]),i("div",null,[o[14]||(o[14]=i("label",null,"Local:",-1)),e(i("input",{"onUpdate:modelValue":o[4]||(o[4]=a=>t.novaAuditoria.local=a)},null,512),[[s,t.novaAuditoria.local]])]),i("div",null,[o[15]||(o[15]=i("label",null,"Morada:",-1)),e(i("input",{"onUpdate:modelValue":o[5]||(o[5]=a=>t.novaAuditoria.morada=a)},null,512),[[s,t.novaAuditoria.morada]])]),i("div",J,[o[16]||(o[16]=i("label",null,"Materiais:",-1)),e(i("textarea",{"onUpdate:modelValue":o[6]||(o[6]=a=>t.novaAuditoria.materiais=a)},null,512),[[s,t.novaAuditoria.materiais]])]),i("div",null,[o[17]||(o[17]=i("label",null,"Data:",-1)),e(i("input",{type:"datetime-local","onUpdate:modelValue":o[7]||(o[7]=a=>t.novaAuditoria.data=a)},null,512),[[s,t.novaAuditoria.data]])])]),o[19]||(o[19]=i("h4",{class:"mt-5 mb-3"},"Equipa de Auditores",-1)),i("div",F,[i("table",M,[o[18]||(o[18]=i("thead",null,[i("tr",null,[i("th",null,"ID"),i("th",null,"Nome"),i("th",null,"Localidade"),i("th",null,"Auditorias")])],-1)),i("tbody",null,[(S(!0),c(O,null,N(t.auditores,a=>(S(),c("tr",{key:a.id,onClick:d=>r.alternarSelecao(a.id),class:g({"linha-selecionada":t.auditoresSelecionados.includes(a.id)})},[i("td",null,p(a.id),1),i("td",null,p(a.nomeCompleto),1),i("td",null,p(a.localidade),1),i("td",null,[i("span",{class:g(["badge",a.auditoriasRealizadas>0?"bg-success":"bg-danger"])},p(a.auditoriasRealizadas),3)])],10,k))),128))])])]),o[20]||(o[20]=i("div",{class:"text-end mt-4"},[i("button",{type:"submit",class:"btn-criar"},"Criar")],-1))],32)])}const D=b(V,[["render",w],["__scopeId","data-v-0de8b457"]]);export{D as default};
